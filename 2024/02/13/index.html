<!DOCTYPE html>
<html lang="ja"><head>
  <title>
     Qiita Hackathon [予選] -  Happy RC Blog !
  </title>
  <meta name="theme-color" content="#a3001b" />
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta name="description" content="ラジコンが楽しくなるような工作やレポートを掲載したいと思います！ラジコン以外にもやってみて苦労したことや、面白かったことについても記録していく予定です！" />
  <meta name="author" content="Tomoki Ikegami" />

  <link rel="stylesheet" href="/Happy_RC.github.io/css/main.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500&family=Ubuntu+Mono&display=swap" rel="stylesheet">
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css"
  />
</head>
<body>
    
    <header class="regular-page-header shadow round-corner">
  <div
    style="
      display: flex;
      justify-content: space-between;
      width: 98%;
      margin-bottom: 0.5em;
    "
  >
    <a class="primary-icon" href="/Happy_RC.github.io/" aria-label="home page">
      <i class="bi bi-house-fill"></i>
    </a>
    
  </div>
  <div class="page-title-and-info" style="text-align: center">
    <h1 class="page-title" >
      Qiita Hackathon [予選]
    </h1>
    
    <p class="document-date">
      2024-02-13 &middot; Tomoki Ikegami × Akmal Fauzi
    </p>
    
    <p class="document-description">"ハンドジェスチャーで操作可能なラジコンを作ってみた！"</p>
     
  </div>
</header>

    
    <main class="card shadow round-corner">
<h1 id="-目次-----omit-in-toc---">～ 目次 ～ <!-- omit in toc --></h1>
<ul>
<li><a href="#1-%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E6%A6%82%E8%A6%81">1. イベント概要</a></li>
<li><a href="#2-%E3%82%A2%E3%82%A4%E3%83%87%E3%82%A2%E5%87%BA%E3%81%97">2. アイデア出し</a></li>
<li><a href="#3-%E6%B1%BA%E3%81%BE%E3%81%A3%E3%81%9F%E8%A3%BD%E5%93%81%E3%82%B3%E3%83%B3%E3%82%BB%E3%83%97%E3%83%88">3. 決まった製品コンセプト</a></li>
<li><a href="#4-%E3%82%B3%E3%83%B3%E3%82%BB%E3%83%97%E3%83%88%E6%B1%BA%E5%AE%9A%E3%81%AE%E8%83%8C%E6%99%AF">4. コンセプト決定の背景</a></li>
<li><a href="#5-%E8%A3%BD%E4%BD%9C%E3%81%AE%E6%B5%81%E3%82%8C">5. 製作の流れ</a>
<ul>
<li><a href="#51-%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A7%8B%E6%88%90">5.1. システム構成</a></li>
<li><a href="#52-%E5%BD%B9%E5%89%B2%E5%88%86%E6%8B%85">5.2. 役割分担</a></li>
</ul>
</li>
<li><a href="#6-%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E3%82%82%E3%81%AE">6. 使用したもの</a>
<ul>
<li><a href="#61-%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2">6.1. ソフトウェア</a></li>
<li><a href="#62-%E3%83%8F%E3%83%BC%E3%83%89%E3%82%A6%E3%82%A7%E3%82%A2">6.2. ハードウェア</a></li>
</ul>
</li>
<li><a href="#7-%E6%A7%8B%E6%88%90">7. 構成</a>
<ul>
<li><a href="#71-%E3%83%8F%E3%83%BC%E3%83%89%E3%82%A6%E3%82%A7%E3%82%A2">7.1. ハードウェア</a></li>
<li><a href="#72-%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2">7.2. ソフトウェア</a>
<ul>
<li><a href="#721-%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E6%A6%82%E8%A6%81%E5%8B%95%E4%BD%9C%E3%83%95%E3%83%AD%E3%83%BC">7.2.1. プログラムの概要、動作フロー</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#8-%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89">8. ソースコード</a>
<ul>
<li><a href="#81-pc%E5%81%B4%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0a">8.1. PC側プログラムA</a></li>
<li><a href="#82-pc%E5%81%B4%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0b">8.2. PC側プログラムB</a></li>
<li><a href="#83-%E3%83%AC%E3%82%B7%E3%83%BC%E3%83%90esp32%E3%83%9E%E3%82%A4%E3%82%B3%E3%83%B3%E5%81%B4%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0">8.3. レシーバ(ESP32マイコン)側プログラム</a></li>
</ul>
</li>
<li><a href="#9-%E5%8B%95%E7%94%BB">9. 動画</a></li>
<li><a href="#10-%E3%81%BE%E3%81%A8%E3%82%81">10. まとめ</a></li>
<li><a href="#11-%E4%BB%8A%E5%BE%8C%E3%81%AE%E4%BA%88%E5%AE%9A">11. 今後の予定</a></li>
<li><a href="#12-%E3%81%8A%E3%81%BE%E3%81%91">12. おまけ</a></li>
<li><a href="#13-%E8%AC%9D%E8%BE%9E">13. 謝辞</a></li>
<li><a href="#14-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">14. 参考文献</a></li>
</ul>
<hr>
<h1 id="1-イベント概要">1. イベント概要</h1>
<p>　2日間でプログラミングを用いてテーマに沿ったアプリ、IoTなどプロダクトを開発し、発表するイベントです（公式ページは<a href="https://qiita.com/official-campaigns/hackathon/2024-first">こちら</a>）。予選は2024/02/10-11、本選は2024/03/02-03に実施されます。本選に行くことはできませんでしたが、色々な人の面白いプロダクトと発表を見れてととても楽しかったです！</p>
<p>　予選のテーマは「<strong>つながり</strong>」でした。</p>
<h1 id="2-アイデア出し">2. アイデア出し</h1>
<p>　インドネシア人留学生のAkmalと一緒にこのイベントに参加しました。母国語が私は日本語、Akmalはインドネシア語なのでどのように進めようか悩みました。2人とも英語が話せるので（私はカタコトですがｗ）英語で作業をすすめることにしました。テーマの「つながり」を「connection」と訳して、ブレスト形式で2人でアイデア出しを進めました。</p>
  <div align="center">
  <figure><img src="ideate.png"
         alt="Ideate (アイデア出し)"/>
</figure>

  </div>
  <div style="text-align: center;">
  ☝　Ideate (アイデア出し)"
  </div>
<h1 id="3-決まった製品コンセプト">3. 決まった製品コンセプト</h1>
<p>　<strong>非言語で操作可能な機械</strong>を開発することにしました。この装置で「人」と「人」、「ソフトウェア」と「ハードウェア」の「<strong>つながり</strong>」を実現します。</p>
  <div align="center">
  <figure><img src="concept.png"
         alt="Product Concept (製品コンセプト)"/>
</figure>

  </div>
  <div style="text-align: center;">
  ☝　Product Concept (製品コンセプト)
  </div>
<h1 id="4-コンセプト決定の背景">4. コンセプト決定の背景</h1>
<p>　私は留学生と暮らしていて、家電の使い方を説明することが多くありました。留学生の人も苦労していました。日本の家電は、操作ボタンが日本語で書かれているため、他の国の人は理解できません。ボタンのスペースには制約があるため、複数言語をプリントできないのは納得なのですが、何とかこの課題を解決したいと考えました。そこで、非言語で家電を操作したいと考えました。</p>
<p>　非言語で操作できる機械ができれば、色々な国の「人」と「人」の協調作業を通して「<strong>つながり</strong>」を提供できると考えました。また、これを達成するためには「ソフトウェア」だけでなく「ハードウェア」のセットアップが必須であり、「ソフトウェア」と「ハードウェア」の「<strong>つながり</strong>」も実現が必要です。</p>
<p>　そこで、<strong>非言語で機械を操作し「人」と「人」、「ソフトウェア」と「ハードウェア」のつながり</strong>を達成したいと考えました！</p>
  <div align="center">
  <figure><img src="japanese_devices.png"
         alt="Japanese hardware (例：日本の家電)"/>
</figure>

  </div>
  <div style="text-align: center;">
  ☝　Japanese hardware (例：日本の家電)
  </div>
<h1 id="5-製作の流れ">5. 製作の流れ</h1>
<h2 id="51-システム構成">5.1. システム構成</h2>
<p>　考えたシステム構成はこちらになります。本当は家電を操作したかったのですが、改造する必要があったためやめました。（時間も限られていたので）</p>
<p>　代わりに、ラジコンを操作することしました。このラジコンにはESP32を搭載しており、BluetoothやWi-Fiで操縦できるように独自に改造を施しています（回路図は後で説明します）</p>
<p>　動作の流れは、</p>
<ol>
<li>PCからハンドジェスチャー（画像認識）に基づいて制御命令を生成</li>
<li>制御命令をPCからESP32マイコンに無線送信（Bluetooth）</li>
<li>PCから受信した制御命令に基づいて、ラジコンカーを制御</li>
</ol>
<p>　という感じです。</p>
  <div align="center">
  <figure><img src="system_overview.png"
         alt="System overview (システムの概要)"/>
</figure>

  </div>
  <div style="text-align: center;">
  ☝　System overview (システムの概要)
  </div>
<h2 id="52-役割分担">5.2. 役割分担</h2>
<p>　作業時間が限られているので、それぞれの強みを活かして効率よく開発を進めます。分担は次のようにしました。</p>
<ul>
<li>
<p>Tomoki：ハードウェアのセットアップ、無線通信（Bluetooth）、ラジコンの制御プログラム構築</p>
</li>
<li>
<p>Akmal：手のポーズ認識、制御命令の生成プログラムの作成</p>
<div align="center">
<figure><img src="system_overview_part.png"
         alt="Role allocation (役割分担)"/>
</figure>

</div>
<div style="text-align: center;">
☝　Role allocation (役割分担)
</div>
</li>
</ul>
<h1 id="6-使用したもの">6. 使用したもの</h1>
<p>　作業にあたって使用したソフトとハードウェア（装置）を整理しておきます。</p>
<h2 id="61-ソフトウェア">6.1. ソフトウェア</h2>
<ol>
<li>Arduino IDE（ESP32マイコン用のプログラム開発）</li>
<li>Visual Studio Code (PC用プログラムの作成)</li>
</ol>
<h2 id="62-ハードウェア">6.2. ハードウェア</h2>
<ul>
<li>
<p>ラジコンカー本体：ECX Barrage 1.9（1/12スケールロッククローラRC）←お気に入りです!</p>
</li>
<li>
<p>マイコンボード：ESP32-WROOM-32E ← PCと通信、ラジコンの制御命令生成</p>
</li>
<li>
<p>走行用バッテリー：Dynamite Speedpack (7.2V Ni-MH 700mAh) ←ESCに電源供給</p>
</li>
<li>
<p>クローラ用ESC：TEKIN BXR ←モータを回転</p>
</li>
<li>
<p>走行用モータ：Dynamite Tazer 370 Motor（DYNS1209）←ギアを回転させてタイヤを駆動</p>
</li>
<li>
<p>サーボモータ：Hitec DB777WP ←ステアを操作</p>
</li>
<li>
<p>フォトリフレクタ：LBR-127HLD ←センターシャフトの回転検出用（今回は使用していない）</p>
<div align="center">
<figure><img src="hardware_overview.png"
         alt="Hardware (ハードウェア)"/>
</figure>

</div>
<div style="text-align: center;">
☝　Hardware (ハードウェア)
</div>
</li>
</ul>
<h1 id="7-構成">7. 構成</h1>
<h2 id="71-ハードウェア">7.1. ハードウェア</h2>
<p>　まずラジコンの構造は下の図のようになってます。このレシーバ部分を自作のもの（&ldquo;Happy RC Driver&rdquo;）に置き換えました。</p>
  <div align="center">
  <figure><img src="rc_car_mechanism.svg"
         alt="R/C car mechanism (ラジコンカーの仕組み)"/>
</figure>

  </div>
  <div style="text-align: center;">
  ☝　R/C car mechanism (ラジコンカーの仕組み)
  </div>
<p>　レシーバの回路図（結線図）は下の画像のようになっています。</p>
  <div align="center">
  <figure><img src="rc_control_using_esp32_bluetooth_with_speedometer_v2_eng.svg"
         alt="DIY receiver circuit (自作レシーバ回路)"/>
</figure>

  </div>
  <div style="text-align: center;">
  ☝　DIY receiver circuit (自作レシーバ回路)
  </div>
<p>　回路の動作原理としては、マイコンが制御信号（PWM）を生成して、ラジコンのサーボモータと走行用モータを制御する仕組みになっています。</p>
<p>　サーボモータや走行用モータ用の電源はマイコンから直接取るのではなく、走行用の 7.2 [V]バッテリーから取るよう工夫しています。（マイコンだけでは電源不足になるため）</p>
<h2 id="72-ソフトウェア">7.2. ソフトウェア</h2>
<h3 id="721-プログラムの概要動作フロー">7.2.1. プログラムの概要、動作フロー</h3>
<p>　PC側のプログラムは A.ポーズ検出用プログラム、B.制御命令送信用プログラムの2つで構成されています。実際にはプログラムAをプログラムBにインポートすることで、動作を実現しています。</p>
<p>　マイコン側のプログラムは、受信した制御命令に応じてサーボモータとESCを制御するようにしています。制御用のPWM信号は ESP32Servoライブラリを使って生成しています。</p>
<p>　また、PCとマイコン間はBluetooth通信で接続しています。通信には、PC側のPython側プログラムにpyserialモジュール、レシーバ側のC++（Arduinoの）プログラムにはBluetoothSerialライブラリを使っています。</p>
  <div align="center">
  <figure><img src="program_overview.svg"
         alt="Programs connection (プログラムの接続)"/>
</figure>

  </div>
  <div style="text-align: center;">
  ☝　Programs connection (プログラムの接続)
  </div>
<p>　動作を流れを整理すると、下の図のようになります。</p>
  <div align="center">
  <figure><img src="software_logic.png"
         alt="Software logic (動作フロー)"/>
</figure>

  </div>
  <div style="text-align: center;">
  ☝　Software logic (動作フロー)
  </div>
<h1 id="8-ソースコード">8. ソースコード</h1>
<p>　本番に使ったソースコード（<a href="https://github.com/TomokiIkegami/tsunagaru_machine_everyone/tree/main">GitHub</a>にもあります）をそのまま載せます。急いで作ったので整理されてませんがお許しください&hellip;</p>
<p>　このプログラムを実際に使うときは、「\♯」を&quot;#&ldquo;に置き換えて使ってください（Markdownで「#」をエスケープしたかったのですができませんでした）</p>
<p>　PC側のPythonプログラムでハンドジェスチャーを認識するために、<a href="https://github.com/cvzone/cvzone">CVZone</a> というパッケージを使ってます。</p>
<p>　さらに、ハンドジェスチャー認識のプログラムと、マイコンからの信号を受信する（今回は使いませんでしたが、センサの電圧だけ読み取るようにしてます）処理を同時に行うため、マルチスレッドで並行処理しています。</p>
<h2 id="81-pc側プログラムa">8.1. PC側プログラムA</h2>
  <br>
  <div style="text-align: center;">
⇩⇩⇩ ソースコード ⇩⇩⇩
  </div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> cv2
from cvzone<span style="color:#f92672">.</span><span style="color:#a6e22e">HandTrackingModule</span> <span style="color:#f92672">import</span> HandDetector

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HandDirectionDetector</span><span style="color:#f92672">:</span>
    def <span style="color:#a6e22e">__init__</span><span style="color:#f92672">(</span>self<span style="color:#f92672">):</span>
        self<span style="color:#f92672">.</span><span style="color:#a6e22e">detector</span> <span style="color:#f92672">=</span> HandDetector<span style="color:#f92672">(</span>detectionCon<span style="color:#f92672">=</span>0<span style="color:#f92672">.</span><span style="color:#a6e22e">8</span><span style="color:#f92672">,</span> maxHands<span style="color:#f92672">=</span>1<span style="color:#f92672">)</span>

    def <span style="color:#a6e22e">determine_direction</span><span style="color:#f92672">(</span>self<span style="color:#f92672">,</span> finger_count<span style="color:#f92672">):</span>
        <span style="color:#66d9ef">if</span> finger_count <span style="color:#f92672">==</span> 1<span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>forward<span style="color:#960050;background-color:#1e0010">&#39;</span>
        elif finger_count <span style="color:#f92672">==</span> 2<span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>backward<span style="color:#960050;background-color:#1e0010">&#39;</span>
        elif finger_count <span style="color:#f92672">==</span> 3<span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>right_and_backward<span style="color:#960050;background-color:#1e0010">&#39;</span>
        elif finger_count <span style="color:#f92672">==</span> 4<span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>left_and_backward<span style="color:#960050;background-color:#1e0010">&#39;</span>
        elif finger_count <span style="color:#f92672">==</span> 5<span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>right_and_forward<span style="color:#960050;background-color:#1e0010">&#39;</span>
        elif finger_count <span style="color:#f92672">==</span> 0<span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>left_and_forward<span style="color:#960050;background-color:#1e0010">&#39;</span>
        <span style="color:#66d9ef">else</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>stop<span style="color:#960050;background-color:#1e0010">&#39;</span>

    def <span style="color:#a6e22e">detect_hand_direction</span><span style="color:#f92672">(</span>self<span style="color:#f92672">,</span> frame<span style="color:#f92672">):</span>
        hands<span style="color:#f92672">,</span> img <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span><span style="color:#a6e22e">detector</span><span style="color:#f92672">.</span><span style="color:#a6e22e">findHands</span><span style="color:#f92672">(</span>frame<span style="color:#f92672">)</span>
        
        <span style="color:#66d9ef">if</span> hands<span style="color:#f92672">:</span>
            lmList <span style="color:#f92672">=</span> hands<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>

            finger_count <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span><span style="color:#a6e22e">detector</span><span style="color:#f92672">.</span><span style="color:#a6e22e">fingersUp</span><span style="color:#f92672">(</span>lmList<span style="color:#f92672">)</span>
            cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">putText</span><span style="color:#f92672">(</span>frame<span style="color:#f92672">,</span> f<span style="color:#960050;background-color:#1e0010">&#39;</span>Finger count<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>sum<span style="color:#f92672">(</span>finger_count<span style="color:#f92672">)}</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span>10<span style="color:#f92672">,</span> 30<span style="color:#f92672">),</span> cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">FONT_HERSHEY_COMPLEX</span><span style="color:#f92672">,</span> 1<span style="color:#f92672">,</span> <span style="color:#f92672">(</span>255<span style="color:#f92672">,</span> 255<span style="color:#f92672">,</span> 255<span style="color:#f92672">),</span> 1<span style="color:#f92672">,</span>
                        cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">LINE_AA</span><span style="color:#f92672">)</span>

            direction <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span><span style="color:#a6e22e">determine_direction</span><span style="color:#f92672">(</span>sum<span style="color:#f92672">(</span>finger_count<span style="color:#f92672">))</span>

            cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">putText</span><span style="color:#f92672">(</span>frame<span style="color:#f92672">,</span> f<span style="color:#960050;background-color:#1e0010">&#39;</span>Direction<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>direction<span style="color:#f92672">}</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span>10<span style="color:#f92672">,</span> 60<span style="color:#f92672">),</span> cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">FONT_HERSHEY_COMPLEX</span><span style="color:#f92672">,</span> 1<span style="color:#f92672">,</span> <span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> 255<span style="color:#f92672">,</span> 0<span style="color:#f92672">),</span> 2<span style="color:#f92672">,</span>
                        cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">LINE_AA</span><span style="color:#f92672">)</span>

            <span style="color:#66d9ef">return</span> direction

        <span style="color:#66d9ef">return</span> None</code></pre></div>
<h2 id="82-pc側プログラムb">8.2. PC側プログラムB</h2>
  <br>
  <div style="text-align: center;">
⇩⇩⇩ ソースコード ⇩⇩⇩
  </div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#960050;background-color:#1e0010">\#</span> This is a lang controlled program<span style="color:#f92672">.</span>
<span style="color:#960050;background-color:#1e0010">\#</span>　ArduinoからのCdsセンサ出力受信してPythonで読む
<span style="color:#960050;background-color:#1e0010">\#</span>　PythonからArduinoに命令を送る
<span style="color:#e6db74">&#39;&#39;&#39;</span> 参考 
<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> https<span style="color:#f92672">:</span><span style="color:#75715e">//next-k.site/blog/archives/2021/12/09/645
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>2<span style="color:#f92672">]</span> https<span style="color:#f92672">:</span><span style="color:#75715e">//codechacha.com/ja/python-convert-string-to-bytes/
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>3<span style="color:#f92672">]</span> https<span style="color:#f92672">:</span><span style="color:#75715e">//qiita.com/umi_mori/items/757834e0ef75f38cea19
</span><span style="color:#75715e"></span><span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#f92672">import</span> serial   <span style="color:#960050;background-color:#1e0010">#</span> シリアル通信ライブラリ<span style="color:#f92672">]</span>
<span style="color:#f92672">import</span> cv2   <span style="color:#960050;background-color:#1e0010">#</span> OpenCVライブラリ
<span style="color:#f92672">import</span> time    <span style="color:#960050;background-color:#1e0010">#</span> 時間関連のライブラリ
<span style="color:#f92672">import</span> threading    <span style="color:#960050;background-color:#1e0010">#</span> マルチスレッド処理ライブラリ
<span style="color:#f92672">import</span> sys   <span style="color:#960050;background-color:#1e0010">#</span> システム関連のライブラリ

<span style="color:#f92672">import</span> lang <span style="color:#960050;background-color:#1e0010">#</span> 翻訳用プログラム
<span style="color:#960050;background-color:#1e0010">\#</span> <span style="color:#f92672">import</span> hand <span style="color:#960050;background-color:#1e0010">#</span> 手の動き検出用プログラム
from hand <span style="color:#f92672">import</span> HandDirectionDetector
<span style="color:#960050;background-color:#1e0010">#</span>Arduinoのシリアルポート番号と伝送速度を設定
<span style="color:#a6e22e">print</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;connecting to Arduino...&#34;</span><span style="color:#f92672">)</span>
ser <span style="color:#f92672">=</span> serial<span style="color:#f92672">.</span><span style="color:#a6e22e">Serial</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;COM6&#34;</span><span style="color:#f92672">,</span>115200<span style="color:#f92672">)</span> 
<span style="color:#960050;background-color:#1e0010">\#</span> time<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>5<span style="color:#f92672">)</span>
print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;connected to Arduino&#34;</span><span style="color:#f92672">)</span>
result_direction<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stop&#34;</span>

def <span style="color:#a6e22e">func_detect_hand</span><span style="color:#f92672">():</span>
    <span style="color:#66d9ef">while</span> True<span style="color:#f92672">:</span>
        <span style="color:#960050;background-color:#1e0010">#</span> Your code here
        <span style="color:#960050;background-color:#1e0010">#</span> result_direction <span style="color:#f92672">=</span> hand_detector<span style="color:#f92672">.</span><span style="color:#a6e22e">detect_hand_direction</span><span style="color:#f92672">(</span>frame<span style="color:#f92672">)</span>
        sent_command<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{0};&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span>result_direction<span style="color:#f92672">)</span>
        byte_sent_command <span style="color:#f92672">=</span> sent_command<span style="color:#f92672">.</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>utf<span style="color:#f92672">-</span>8<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">)</span>
        ser<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>byte_sent_command<span style="color:#f92672">)</span> <span style="color:#960050;background-color:#1e0010">#</span>制御命令を送信
        time<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>0<span style="color:#f92672">.</span><span style="color:#a6e22e">5</span><span style="color:#f92672">)</span>   <span style="color:#960050;background-color:#1e0010">#</span> 1秒間隔で制御命令を送信
        <span style="color:#66d9ef">if</span> result_direction is not None<span style="color:#f92672">:</span>
            <span style="color:#960050;background-color:#1e0010">#</span> print<span style="color:#f92672">(</span>f<span style="color:#960050;background-color:#1e0010">&#39;</span>Speed<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>result_direction<span style="color:#f92672">}</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">)</span>
            <span style="color:#960050;background-color:#1e0010">#</span> ser<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>byte_sent_command<span style="color:#f92672">)</span> <span style="color:#960050;background-color:#1e0010">#</span>制御命令を送信
            <span style="color:#a6e22e">print</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byte_sent_command&#34;</span><span style="color:#f92672">)</span>
            <span style="color:#960050;background-color:#1e0010">#</span> time<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>   <span style="color:#960050;background-color:#1e0010">#</span> 1秒間隔で制御命令を送信



<span style="color:#960050;background-color:#1e0010">\#</span> def <span style="color:#a6e22e">func_control</span><span style="color:#f92672">():</span>
<span style="color:#960050;background-color:#1e0010">\#</span>     <span style="color:#66d9ef">while</span> True<span style="color:#f92672">:</span>   <span style="color:#960050;background-color:#1e0010">#</span> キーボード入力によって<span style="color:#960050;background-color:#1e0010">、</span>Arduinoに制御命令を送信
<span style="color:#960050;background-color:#1e0010">\#</span>         <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>contorol_command<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;q&#34;</span><span style="color:#f92672">):</span>  <span style="color:#960050;background-color:#1e0010">#</span> qを入力するとプログラムを終了
<span style="color:#960050;background-color:#1e0010">\#</span>         <span style="color:#960050;background-color:#1e0010">#</span>     ser<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">()</span>
<span style="color:#960050;background-color:#1e0010">\#</span>         <span style="color:#960050;background-color:#1e0010">#</span>     sys<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>
<span style="color:#960050;background-color:#1e0010">\#</span>         ser<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>result_direction<span style="color:#f92672">)</span> <span style="color:#960050;background-color:#1e0010">#</span>制御命令を送信
<span style="color:#960050;background-color:#1e0010">\#</span>         time<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>   <span style="color:#960050;background-color:#1e0010">#</span> 1秒間隔で制御命令を送信

def <span style="color:#a6e22e">func_read</span><span style="color:#f92672">():</span>
    <span style="color:#66d9ef">while</span> True<span style="color:#f92672">:</span>
        time<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>0<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">)</span> <span style="color:#960050;background-color:#1e0010">#</span> 10<span style="color:#f92672">[</span>ms<span style="color:#f92672">]</span>間隔で計測データを読み取り
        <span style="color:#a6e22e">print</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;read&#34;</span><span style="color:#f92672">)</span>
        val_arduino<span style="color:#f92672">=</span>ser<span style="color:#f92672">.</span><span style="color:#a6e22e">readline</span><span style="color:#f92672">()</span>
        val_decoded<span style="color:#f92672">=</span>val_arduino<span style="color:#f92672">.</span><span style="color:#a6e22e">strip</span><span style="color:#f92672">().</span><span style="color:#a6e22e">decode</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">)</span>
        print<span style="color:#f92672">(</span>val_decoded<span style="color:#f92672">)</span> <span style="color:#960050;background-color:#1e0010">#</span>val_arduino<span style="color:#f92672">:</span>byte型なのでb<span style="color:#960050;background-color:#1e0010">&#39;</span>文字列<span style="color:#960050;background-color:#1e0010">&#39;</span>となって出てくる

<span style="color:#66d9ef">if</span> __name__<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;__main__&#34;</span><span style="color:#f92672">:</span>
    thread_1<span style="color:#f92672">=</span>threading<span style="color:#f92672">.</span><span style="color:#a6e22e">Thread</span><span style="color:#f92672">(</span>target<span style="color:#f92672">=</span>func_detect_hand<span style="color:#f92672">)</span>
    thread_2<span style="color:#f92672">=</span>threading<span style="color:#f92672">.</span><span style="color:#a6e22e">Thread</span><span style="color:#f92672">(</span>target<span style="color:#f92672">=</span>func_read<span style="color:#f92672">)</span>
    <span style="color:#960050;background-color:#1e0010">#</span> thread_3<span style="color:#f92672">=</span>threading<span style="color:#f92672">.</span><span style="color:#a6e22e">Thread</span><span style="color:#f92672">(</span>target<span style="color:#f92672">=</span>func_control<span style="color:#f92672">)</span>


    thread_1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">()</span>
    thread_2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">()</span>
    <span style="color:#960050;background-color:#1e0010">#</span> thread_3<span style="color:#f92672">=</span>start<span style="color:#f92672">()</span>

    <span style="color:#960050;background-color:#1e0010">#</span> Inisialisasi objek HandDirectionDetector
<span style="color:#960050;background-color:#1e0010">\#</span> hand_detector <span style="color:#f92672">=</span> HandDirectionDetector<span style="color:#f92672">()</span>

    hand_detector <span style="color:#f92672">=</span> HandDirectionDetector<span style="color:#f92672">()</span>
<span style="color:#960050;background-color:#1e0010">\#</span> Inisialisasi tangkapan video
    video <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">VideoCapture</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>

    <span style="color:#960050;background-color:#1e0010">#</span> Loop utama
    <span style="color:#66d9ef">while</span> True<span style="color:#f92672">:</span>
        <span style="color:#960050;background-color:#1e0010">#</span> Membaca frame dari video
        ret<span style="color:#f92672">,</span> frame <span style="color:#f92672">=</span> video<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">()</span>
        frame <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">flip</span><span style="color:#f92672">(</span>frame<span style="color:#f92672">,</span> 1<span style="color:#f92672">)</span>

        <span style="color:#960050;background-color:#1e0010">#</span> Mendapatkan arah dari objek HandDirectionDetector
        result_direction <span style="color:#f92672">=</span> hand_detector<span style="color:#f92672">.</span><span style="color:#a6e22e">detect_hand_direction</span><span style="color:#f92672">(</span>frame<span style="color:#f92672">)</span>

        <span style="color:#960050;background-color:#1e0010">#</span> Print hasil di terminal
        <span style="color:#66d9ef">if</span> result_direction is not None<span style="color:#f92672">:</span>
            <span style="color:#960050;background-color:#1e0010">#</span> print<span style="color:#f92672">(</span>f<span style="color:#960050;background-color:#1e0010">&#39;</span>Speed<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>result_direction<span style="color:#f92672">}</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">)</span>
            pass

        <span style="color:#960050;background-color:#1e0010">#</span> Menampilkan frame
        cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">imshow</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;frame&#34;</span><span style="color:#f92672">,</span> frame<span style="color:#f92672">)</span>

        <span style="color:#960050;background-color:#1e0010">#</span> Cek jika tombol <span style="color:#e6db74">&#39;k&#39;</span> ditekan untuk keluar dari loop
        k <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">waitKey</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">if</span> k <span style="color:#f92672">==</span> ord<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;k&#34;</span><span style="color:#f92672">):</span>
            <span style="color:#66d9ef">break</span>

    <span style="color:#960050;background-color:#1e0010">#</span> Melepas tangkapan video dan menutup jendela OpenCV
    video<span style="color:#f92672">.</span><span style="color:#a6e22e">release</span><span style="color:#f92672">()</span>
    cv2<span style="color:#f92672">.</span><span style="color:#a6e22e">destroyAllWindows</span>

    <span style="color:#960050;background-color:#1e0010">#</span> ser<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">()</span></code></pre></div>
<h2 id="83-レシーバesp32マイコン側プログラム">8.3. レシーバ(ESP32マイコン)側プログラム</h2>
  <br>
  <div style="text-align: center;">
⇩⇩⇩ ソースコード ⇩⇩⇩
  </div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/*Arduinoからデータを送ってPythonで読む*/</span>
<span style="color:#75715e">/*参考文献*/</span>
<span style="color:#75715e">//[1]:https://tomson784.github.io/memo/python/arduino/2021/05/25/pyserial-arduino.html
</span><span style="color:#75715e">//[2]:https://tanudon.work/499/
</span><span style="color:#75715e">//[3]:https://spiceman.jp/arduino-cds-program/
</span><span style="color:#75715e"></span>

<span style="color:#75715e">/*ライブラリ*/</span>
<span style="color:#960050;background-color:#1e0010">#</span>include <span style="color:#e6db74">&#34;BluetoothSerial.h&#34;</span>  <span style="color:#75715e">//ESP32のBluetooth通信に使用
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span>define PI 3<span style="color:#f92672">.</span><span style="color:#a6e22e">141592653589793</span> <span style="color:#75715e">//円周率
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*Bluetooth通信に必要*/</span>
BluetoothSerial ESP_BT<span style="color:#f92672">;</span>  <span style="color:#75715e">//ESP_BTという名前でオブジェクトを定義
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*ハードウェアの接続ピンの設定*/</span>
<span style="color:#960050;background-color:#1e0010">#</span>define SERVO_PWM_PIN 4    <span style="color:#75715e">//サーボモータのPWMピン（信号入力ピン）をESP32の4番ピンに接続 ★回路と対応した番号にする
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span>define ESC_PWM_PIN 16     <span style="color:#75715e">//ESCのPWMピン（信号入力ピン）をESP32の16番ピンに接続 ★回路と対応した番号にする
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*ライブラリ*/</span>
<span style="color:#960050;background-color:#1e0010">#</span>include <span style="color:#f92672">&lt;</span>ESP32Servo<span style="color:#f92672">.</span><span style="color:#a6e22e">h</span><span style="color:#f92672">&gt;</span> <span style="color:#75715e">//ESC・サーボモータの制御に使用
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span>include <span style="color:#f92672">&lt;</span>BLEDevice<span style="color:#f92672">.</span><span style="color:#a6e22e">h</span><span style="color:#f92672">&gt;</span>  <span style="color:#75715e">//Bluetooth通信用
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span>include <span style="color:#f92672">&lt;</span>BLEServer<span style="color:#f92672">.</span><span style="color:#a6e22e">h</span><span style="color:#f92672">&gt;</span>  <span style="color:#75715e">//Bluetooth通信用    
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span>include <span style="color:#f92672">&lt;</span>BLEUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">h</span><span style="color:#f92672">&gt;</span>   <span style="color:#75715e">//Bluetooth通信用
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span>include <span style="color:#f92672">&lt;</span>BLE2902<span style="color:#f92672">.</span><span style="color:#a6e22e">h</span><span style="color:#f92672">&gt;</span>    <span style="color:#75715e">//Bluetooth通信用
</span><span style="color:#75715e"></span>
BLECharacteristic <span style="color:#f92672">*</span>pCharacteristic<span style="color:#f92672">;</span> <span style="color:#75715e">//Characteristicを定義
</span><span style="color:#75715e"></span>bool deviceConnected <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span> <span style="color:#75715e">//接続状態を保存する変数
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*ESC,サーボのオブジェクト作成*/</span>
Servo myservo<span style="color:#f92672">;</span>  <span style="color:#75715e">// サーボモータを制御するためのServoオブジェクト作成
</span><span style="color:#75715e"></span>Servo myesc<span style="color:#f92672">;</span>    <span style="color:#75715e">// ESCを制御するためのServoオブジェクト作成
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> pulsew_min <span style="color:#f92672">=</span> 500<span style="color:#f92672">;</span>   <span style="color:#75715e">//minimum pulse width of servo motor（サーボモータの最小パルス幅）
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> pulsew_max <span style="color:#f92672">=</span> 2400<span style="color:#f92672">;</span>  <span style="color:#75715e">//maximum pulse width of servo motor（サーボモータの最大パルス幅）
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*ステアリングの設定*/</span>
unsigned <span style="color:#66d9ef">long</span> mov_speed_ST <span style="color:#f92672">=</span> 40<span style="color:#f92672">;</span>        <span style="color:#75715e">//ステア移動速度
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> center_pos <span style="color:#f92672">=</span> 95<span style="color:#f92672">;</span>                    <span style="color:#75715e">//ステア中心位置 [サーボモータの中心位置 (90°)]　★まっすぐ走るように調整。90より大きい値にするとステア（ハンドル）が右寄りに、90より小さい値にするとステア（ハンドル）が左寄りになる
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> left_DR <span style="color:#f92672">=</span> 20<span style="color:#f92672">;</span>                       <span style="color:#75715e">//左の切れ角 ★:好みに合わせて調整。ただし大きくしすぎないように注意。
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> right_DR <span style="color:#f92672">=</span> 25<span style="color:#f92672">;</span>                      <span style="color:#75715e">//右の切れ角 ★:好みに合わせて調整。ただし大きくしすぎないように注意。
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> left_max <span style="color:#f92672">=</span> center_pos <span style="color:#f92672">-</span> left_DR<span style="color:#f92672">;</span>    <span style="color:#75715e">//左ステアの最大位置 [中心位置より反時計回りに20°（left_DR）回転した位置] ★逆に動くときはleft_DRの手前の符号をプラス（+）に
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> right_max <span style="color:#f92672">=</span> center_pos <span style="color:#f92672">+</span> right_DR<span style="color:#f92672">;</span>  <span style="color:#75715e">//右ステアの最大位置 [中心位置より時計回りに25°（right_DR）回転した位置] ★逆に動くときはright_DRの手前の符号をマイナス（-）に
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*スロットルの設定*/</span>
unsigned <span style="color:#66d9ef">long</span> mov_speed_TH <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>                <span style="color:#75715e">//スロットル移動速度
</span><span style="color:#75715e"></span>unsigned <span style="color:#66d9ef">long</span> mov_speed_brk <span style="color:#f92672">=</span> 40<span style="color:#f92672">;</span>              <span style="color:#75715e">//ブレーキ速度
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> neutral_pos <span style="color:#f92672">=</span> 93<span style="color:#f92672">;</span>                          <span style="color:#75715e">//中立位置 [スロットルの中立位置 (90) ★ESCの設定によってずれがあるので、前後に走行しないよう値を調整する。※ ESC側を90で中立になるよう設定（上級者向け。ESCの説明書通りプロポでニュートラル設定を済ませてから、このプログラムの値を調整するのがオススメ）してもよい。]
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> forward_DR <span style="color:#f92672">=</span> 10<span style="color:#f92672">;</span>                           <span style="color:#75715e">//前進の速さ ★好みの速度に調整
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> backward_DR <span style="color:#f92672">=</span> 10<span style="color:#f92672">;</span>                          <span style="color:#75715e">//バックの速さ ★好みの速度に調整
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> forward_max <span style="color:#f92672">=</span> neutral_pos <span style="color:#f92672">+</span> forward_DR<span style="color:#f92672">;</span>    <span style="color:#75715e">//前進の最大位置 ★逆に動くときはforward_DRの手前の符号をマイナス（-）に
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> backward_max <span style="color:#f92672">=</span> neutral_pos <span style="color:#f92672">-</span> backward_DR<span style="color:#f92672">;</span>  <span style="color:#75715e">//バックの最大位置 ★逆に動くときはbackward_DRの手前の符号をプラス（+）に
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> turbo_speed <span style="color:#f92672">=</span> 120<span style="color:#f92672">;</span>                         <span style="color:#75715e">//全開走行時の速度（180が最大。速すぎると思ったら170や160など値を小さくしてみる）
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*値設定の注意点*/</span>
<span style="color:#75715e">//速度(mov_speed_ST,mov_speed_TH)は 0-50 の範囲で与える。（0：最低速度、50:最大速度）
</span><span style="color:#75715e">//スロットル、サーボモータの値(pos)の範囲は、 0≦ pos ≦180 で与える。
</span><span style="color:#75715e">//myservo.write 関数には回転角を絶対的な位置で与える。例) 90°から 45°反時計回りに動いてほしいときは、-45ではなく、45を関数に入力する。
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*ステアとスロットルの位置を記憶する変数*/</span>
<span style="color:#66d9ef">int</span> CH1 <span style="color:#f92672">=</span> center_pos<span style="color:#f92672">;</span>   <span style="color:#75715e">//CH1:ステア
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> CH2 <span style="color:#f92672">=</span> neutral_pos<span style="color:#f92672">;</span>  <span style="color:#75715e">//CH2:スロットル
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*プログラムの流れを制御する変数*/</span>
<span style="color:#66d9ef">char</span> input <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;C&#39;</span><span style="color:#f92672">;</span>             <span style="color:#75715e">//入力信号
</span><span style="color:#75715e"></span>unsigned <span style="color:#66d9ef">long</span> curr<span style="color:#f92672">;</span>           <span style="color:#75715e">/*現在時刻を保存*/</span>
unsigned <span style="color:#66d9ef">long</span> prev_ST <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>    <span style="color:#75715e">/*前時刻を保存*/</span>
unsigned <span style="color:#66d9ef">long</span> prev_TH <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>    <span style="color:#75715e">/*前時刻を保存*/</span>



<span style="color:#66d9ef">int</span> val<span style="color:#f92672">=</span>0<span style="color:#f92672">;</span> <span style="color:#75715e">//センサ入力値
</span><span style="color:#75715e"></span><span style="color:#66d9ef">float</span> voltage<span style="color:#f92672">=</span>0<span style="color:#f92672">;</span> <span style="color:#75715e">//電圧に変換したセンサ入力値
</span><span style="color:#75715e"></span>unsigned <span style="color:#66d9ef">long</span> prevReadTime_ControlSignal <span style="color:#f92672">=</span> millis<span style="color:#f92672">();</span> <span style="color:#75715e">// 制御命令の読み取り処理を始めた時間
</span><span style="color:#75715e"></span><span style="color:#66d9ef">long</span> readPeriod_ControlSignal <span style="color:#f92672">=</span> 50<span style="color:#f92672">;</span> <span style="color:#75715e">// 制御命令の読み取り周期 [ms]
</span><span style="color:#75715e"></span>unsigned <span style="color:#66d9ef">long</span> prevReadTime_Sensor1 <span style="color:#f92672">=</span> millis<span style="color:#f92672">();</span> <span style="color:#75715e">// センサ値の読み取り処理を始めた時間
</span><span style="color:#75715e"></span><span style="color:#66d9ef">long</span> samplingRate_Sensor1 <span style="color:#f92672">=</span> 150<span style="color:#f92672">;</span> <span style="color:#75715e">// センサの読み取り周期 [ms]
</span><span style="color:#75715e"></span>String received_data_byte<span style="color:#f92672">;</span>
String received_data <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1500&#34;</span><span style="color:#f92672">;</span>

<span style="color:#75715e">/*PWM制御でサーボモータの角度を制御する関数*/</span>
<span style="color:#75715e">/*ステアを操作する関数*/</span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">change_ST_pos</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> goal_pos<span style="color:#f92672">,</span> unsigned <span style="color:#66d9ef">long</span> mov_speed<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  unsigned <span style="color:#66d9ef">long</span> delay_time <span style="color:#f92672">=</span> 50 <span style="color:#f92672">-</span> mov_speed<span style="color:#f92672">;</span>  <span style="color:#75715e">//処理を遅くする時間（この値が大きいとゆっくりな操作に）
</span><span style="color:#75715e"></span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>curr <span style="color:#f92672">-</span> prev_ST<span style="color:#f92672">)</span> <span style="color:#f92672">&gt;=</span> delay_time<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">/*ステアを切る処理*/</span>
    <span style="color:#75715e">//右折
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>goal_pos <span style="color:#f92672">-</span> CH1 <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      CH1<span style="color:#f92672">++;</span>
      myservo<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>CH1<span style="color:#f92672">);</span>
      <span style="color:#75715e">//左折
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>goal_pos <span style="color:#f92672">-</span> CH1 <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      CH1<span style="color:#f92672">--;</span>
      myservo<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>CH1<span style="color:#f92672">);</span>

      <span style="color:#75715e">//その他→ステアはそのまま
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
      myservo<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>CH1<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    prev_ST <span style="color:#f92672">=</span> curr<span style="color:#f92672">;</span>  <span style="color:#75715e">//前回に処理を実行した時刻を現在時刻に更新
</span><span style="color:#75715e"></span>  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">/*スロットルを操作する関数*/</span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">change_TH_pos</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> goal_pos<span style="color:#f92672">,</span> unsigned <span style="color:#66d9ef">long</span> mov_speed<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  unsigned <span style="color:#66d9ef">long</span> delay_time <span style="color:#f92672">=</span> 50 <span style="color:#f92672">-</span> mov_speed<span style="color:#f92672">;</span>  <span style="color:#75715e">//処理を遅くする時間（この値が大きいとゆっくりな操作に）
</span><span style="color:#75715e"></span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>curr <span style="color:#f92672">-</span> prev_TH<span style="color:#f92672">)</span> <span style="color:#f92672">&gt;=</span> delay_time<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">/*スロットルを操作する処理*/</span>
    <span style="color:#75715e">//前進
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>goal_pos <span style="color:#f92672">-</span> CH2 <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      CH2<span style="color:#f92672">++;</span>
      myesc<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>CH2<span style="color:#f92672">);</span>
      <span style="color:#75715e">//後退
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>goal_pos <span style="color:#f92672">-</span> CH2 <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      CH2<span style="color:#f92672">--;</span>
      myesc<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>CH2<span style="color:#f92672">);</span>

      <span style="color:#75715e">//その他→スロットルはそのまま
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
      myesc<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>CH2<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    prev_TH <span style="color:#f92672">=</span> curr<span style="color:#f92672">;</span>  <span style="color:#75715e">//前回に処理を実行した時刻を現在時刻に更新
</span><span style="color:#75715e"></span>  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>


<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    Serial<span style="color:#f92672">.</span><span style="color:#a6e22e">begin</span><span style="color:#f92672">(</span>115200<span style="color:#f92672">);</span> <span style="color:#75715e">//伝送速度設定
</span><span style="color:#75715e"></span>    ESP_BT<span style="color:#f92672">.</span><span style="color:#a6e22e">begin</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ESP32_RC_Receiver&#34;</span><span style="color:#f92672">);</span>  <span style="color:#75715e">//接続画面で表示される名前を設定 ★好きな名前にしてよい
</span><span style="color:#75715e"></span>    myservo<span style="color:#f92672">.</span><span style="color:#a6e22e">attach</span><span style="color:#f92672">(</span>SERVO_PWM_PIN<span style="color:#f92672">,</span> pulsew_min<span style="color:#f92672">,</span> pulsew_max<span style="color:#f92672">);</span>  <span style="color:#75715e">//サーボモータのPWM端子とArduinoの4番ピンを接続 ★回路と対応した番号にする
</span><span style="color:#75715e"></span>    myesc<span style="color:#f92672">.</span><span style="color:#a6e22e">attach</span><span style="color:#f92672">(</span>ESC_PWM_PIN<span style="color:#f92672">,</span> pulsew_min<span style="color:#f92672">,</span> pulsew_max<span style="color:#f92672">);</span>      <span style="color:#75715e">//ESCのPWM端子とArduinoの16番ピンを接続 ★回路と対応した番号にする
</span><span style="color:#75715e"></span>    Serial<span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Initializing ST and TH position....&#34;</span><span style="color:#f92672">);</span>
    myservo<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>center_pos<span style="color:#f92672">);</span>  <span style="color:#75715e">// ステアを中心(Center)に
</span><span style="color:#75715e"></span>    myesc<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>neutral_pos<span style="color:#f92672">);</span>   <span style="color:#75715e">//中立(Neutral)
</span><span style="color:#75715e"></span>    delay<span style="color:#f92672">(</span>2000<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  
    unsigned <span style="color:#66d9ef">long</span> currentTime <span style="color:#f92672">=</span> millis<span style="color:#f92672">();</span> <span style="color:#75715e">// 現在時刻を取得
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// lcd.setCursor(0,0);
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">/* 1:Receive data from PC */</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>currentTime<span style="color:#f92672">-</span>prevReadTime_ControlSignal<span style="color:#f92672">&gt;</span>readPeriod_ControlSignal<span style="color:#f92672">){</span>
        prevReadTime_ControlSignal<span style="color:#f92672">=</span>currentTime<span style="color:#f92672">;</span> <span style="color:#75715e">// 前時刻を現在の時刻に更新
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>ESP_BT<span style="color:#f92672">.</span><span style="color:#a6e22e">available</span><span style="color:#f92672">()&gt;</span>0<span style="color:#f92672">){</span>
          received_data_byte<span style="color:#f92672">=</span>ESP_BT<span style="color:#f92672">.</span><span style="color:#a6e22e">readStringUntil</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;;&#39;</span><span style="color:#f92672">);</span> <span style="color:#75715e">// read data from PC
</span><span style="color:#75715e"></span>          ESP_BT<span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;received_data=&#34;</span><span style="color:#f92672">+</span>received_data_byte<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    
    <span style="color:#75715e">/* 2:Send data to PC */</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>currentTime<span style="color:#f92672">-</span>prevReadTime_Sensor1<span style="color:#f92672">&gt;</span>samplingRate_Sensor1<span style="color:#f92672">){</span>
        prevReadTime_Sensor1<span style="color:#f92672">=</span>currentTime<span style="color:#f92672">;</span> <span style="color:#75715e">// 前時刻を現在の時刻に更新
</span><span style="color:#75715e"></span>        val<span style="color:#f92672">=</span>analogRead<span style="color:#f92672">(</span>25<span style="color:#f92672">);</span> <span style="color:#75715e">//センサの値などを読む
</span><span style="color:#75715e"></span>        voltage<span style="color:#f92672">=</span><span style="color:#66d9ef">float</span><span style="color:#f92672">(</span>val<span style="color:#f92672">)*(</span>3<span style="color:#f92672">.</span><span style="color:#a6e22e">3</span><span style="color:#f92672">)/(</span>4096<span style="color:#f92672">);</span> <span style="color:#75715e">// AD変換
</span><span style="color:#75715e"></span>        ESP_BT<span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">((</span>String<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;V=&#34;</span><span style="color:#f92672">+</span>voltage<span style="color:#f92672">+</span><span style="color:#e6db74">&#34; [V]&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//文字をシリアルモニタに表示
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>

    curr <span style="color:#f92672">=</span> millis<span style="color:#f92672">();</span>  <span style="color:#75715e">//現在時刻を取得
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/*命令に基づいてラジコンを制御*/</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;forward&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      change_ST_pos<span style="color:#f92672">(</span>center_pos<span style="color:#f92672">,</span> mov_speed_ST<span style="color:#f92672">);</span>   <span style="color:#75715e">// ステアを中心(Center)に
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>forward_max<span style="color:#f92672">,</span> mov_speed_TH<span style="color:#f92672">);</span>  <span style="color:#75715e">//前進(Forward)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;backward&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      change_ST_pos<span style="color:#f92672">(</span>center_pos<span style="color:#f92672">,</span> mov_speed_ST<span style="color:#f92672">);</span>    <span style="color:#75715e">// ステアを中心(Center)に
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>backward_max<span style="color:#f92672">,</span> mov_speed_TH<span style="color:#f92672">);</span>  <span style="color:#75715e">//後退(Backward)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;stop&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      forward_max <span style="color:#f92672">=</span> neutral_pos <span style="color:#f92672">+</span> forward_DR<span style="color:#f92672">;</span>     <span style="color:#75715e">//標準の速度に設定
</span><span style="color:#75715e"></span>      change_ST_pos<span style="color:#f92672">(</span>center_pos<span style="color:#f92672">,</span> mov_speed_ST<span style="color:#f92672">);</span>    <span style="color:#75715e">// ステアを中心(Center)に
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>neutral_pos<span style="color:#f92672">,</span> mov_speed_brk<span style="color:#f92672">);</span>  <span style="color:#75715e">//中立(Neutral)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;left&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      change_ST_pos<span style="color:#f92672">(</span>left_max<span style="color:#f92672">,</span> mov_speed_ST<span style="color:#f92672">);</span>      <span style="color:#75715e">// ステアを左(Left)に切る
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>neutral_pos<span style="color:#f92672">,</span> mov_speed_brk<span style="color:#f92672">);</span>  <span style="color:#75715e">//中立(Neutral)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;right&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      change_ST_pos<span style="color:#f92672">(</span>right_max<span style="color:#f92672">,</span> mov_speed_ST<span style="color:#f92672">);</span>     <span style="color:#75715e">// ステアを右(Right)に切る
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>neutral_pos<span style="color:#f92672">,</span> mov_speed_brk<span style="color:#f92672">);</span>  <span style="color:#75715e">//中立(Neutral)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;left_and_forward&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      change_ST_pos<span style="color:#f92672">(</span>left_max<span style="color:#f92672">,</span> mov_speed_ST<span style="color:#f92672">);</span>     <span style="color:#75715e">// ステアを左(Left)に切る
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>forward_max<span style="color:#f92672">,</span> mov_speed_TH<span style="color:#f92672">);</span>  <span style="color:#75715e">//前進(Forward)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;right_and_forward&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      change_ST_pos<span style="color:#f92672">(</span>right_max<span style="color:#f92672">,</span> mov_speed_ST<span style="color:#f92672">);</span>    <span style="color:#75715e">// ステアを右(Right)に切る
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>forward_max<span style="color:#f92672">,</span> mov_speed_TH<span style="color:#f92672">);</span>  <span style="color:#75715e">//前進(Forward)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;left_and_backward&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      change_ST_pos<span style="color:#f92672">(</span>left_max<span style="color:#f92672">,</span> mov_speed_ST<span style="color:#f92672">);</span>      <span style="color:#75715e">// ステアを左(Left)に切る
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>backward_max<span style="color:#f92672">,</span> mov_speed_TH<span style="color:#f92672">);</span>  <span style="color:#75715e">//後退(Backward)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;right_and_backward&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      change_ST_pos<span style="color:#f92672">(</span>right_max<span style="color:#f92672">,</span> mov_speed_ST<span style="color:#f92672">);</span>     <span style="color:#75715e">// ステアを右(Right)に切る
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>backward_max<span style="color:#f92672">,</span> mov_speed_TH<span style="color:#f92672">);</span>  <span style="color:#75715e">//後退(Backward)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;accelerate&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      forward_max <span style="color:#f92672">=</span> turbo_speed<span style="color:#f92672">;</span>                 <span style="color:#75715e">//ターボの速度に設定
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>forward_max<span style="color:#f92672">,</span> mov_speed_TH<span style="color:#f92672">);</span>  <span style="color:#75715e">//前進(Forward)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>received_data_byte <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;deaccelerate&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      forward_max <span style="color:#f92672">=</span> neutral_pos <span style="color:#f92672">+</span> forward_DR<span style="color:#f92672">;</span>    <span style="color:#75715e">//標準の速度に設定
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>forward_max<span style="color:#f92672">,</span> mov_speed_TH<span style="color:#f92672">);</span>  <span style="color:#75715e">//前進(Forward)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
      change_ST_pos<span style="color:#f92672">(</span>center_pos<span style="color:#f92672">,</span> 50<span style="color:#f92672">);</span>   <span style="color:#75715e">// ステアを中心(Center)に
</span><span style="color:#75715e"></span>      change_TH_pos<span style="color:#f92672">(</span>neutral_pos<span style="color:#f92672">,</span> 50<span style="color:#f92672">);</span>  <span style="color:#75715e">//中立(Neutral)
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div>
<h1 id="9-動画">9. 動画</h1>
<p>　手のポーズに応じてラジコンを操作します。操作は難しいですが楽しいです！笑<br><br></p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/gPZ5cprDuN0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h1 id="10-まとめ">10. まとめ</h1>
<p>　今回は、手で操作可能な装置を開発しました。この装置の開発を通して、国を超えた「人」と「人」、「ソフトウェア」と「ハードウェア」の「<strong>つながり</strong>」を実現しました。</p>
  <div align="center">
  <figure><img src="summary.png"
         alt="Summary (まとめ)"/>
</figure>

  </div>
  <div style="text-align: center;">
  ☝　Summary (まとめ)
  </div>
<h1 id="11-今後の予定">11. 今後の予定</h1>
<p>　今回はラジコンの走行する向きを制御するまでしかできなかったので、速度を調整できるようにアップデートしたいと考えています。また、ジェスチャーを指の方向にするなど分かりやすくなるように工夫したいです。</p>
<p>　そして、今回は制御対象がラジコンだったので家電などの他の製品に応用したいです。</p>
<h1 id="12-おまけ">12. おまけ</h1>
<p>　実は手で操作するプログラムの前に、キーボードの文字入力で操作するプログラムを作りました（<a href="https://github.com/TomokiIkegami/tsunagaru_machine_everyone/tree/main">GitHub</a>にある lang_machine_controller.py というプログラム）。アイデア出しをした直後は、音声認識で操作したくて音声認識プログラムを作っていたのですが、途中でハンドジェスチャーに切り替えました。このプログラムは音声認識ではありませんが、キーボードで文字を入力（日本語で&quot;migi&quot;と入力すると右に、インドネシア語で&quot;kanan&quot;と入力してもラジコンが右に動きます笑）。Google翻訳のモジュールをPythonにインポートして、このプログラムを組みました。</p>
<h1 id="13-謝辞">13. 謝辞</h1>
<p>　ハッカソンという貴重な機会を提供してくださった Qiita株式会社様、協賛企業の皆様、イベントを一緒に盛り上げてくださった参加の皆様に感謝申し上げます。そして、楽しみながら一緒に開発を進めてくれた Akmal Fauzi 氏に心から感謝致します。</p>
<h1 id="14-参考文献">14. 参考文献</h1>
<ol>
<li>Qiita @umi_mori「シリアル通信入門【Python】」、(<a href="https://qiita.com/umi_mori/items/757834e0ef75f38cea19">https://qiita.com/umi_mori/items/757834e0ef75f38cea19</a>)</li>
<li>tomson784「pythonでArduinoとPC間でシリアル通信する」、(<a href="https://tomson784.github.io/memo/python/arduino/2021/05/25/pyserial-arduino.html">https://tomson784.github.io/memo/python/arduino/2021/05/25/pyserial-arduino.html</a>)</li>
<li>Tanudon Room「Python　§05： pyserialでシリアル通信する方法を解説【初心者向け】」、(<a href="https://tanudon.work/499/">https://tanudon.work/499/</a>)</li>
<li>ITエンジニアのメモ帳「【python】同時に2つ以上の処理を実行する方法(threading)」、(<a href="https://next-k.site/blog/archives/2021/12/09/645">https://next-k.site/blog/archives/2021/12/09/645</a>)</li>
<li>codechacha.com「Python - Stringをbytesに変換する方法」、(<a href="https://codechacha.com/ja/python-convert-string-to-bytes/">https://codechacha.com/ja/python-convert-string-to-bytes/</a>)</li>
<li>GitHub @murtazahassan 「cvzone」、(<a href="https://github.com/cvzone/cvzone">https://github.com/cvzone/cvzone</a>)</li>
</ol>


    </main><footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: { equationNumbers: {autoNumber: "AMS"} },
      tex2jax: {
        inlineMath: [['$','$']]
      }
    });
  </script>
  
  
  
  
  <div class="prev-next">
    <a
      class="active icon"
      href="/Happy_RC.github.io/2024/01/27/"
      aria-label="Previous Article"
      ><i class="bi bi-arrow-left-circle-fill"></i
    ></a>
    <div class="disabled icon"><i class="bi bi-arrow-right-circle-fill"></i></div>
  </div>
  </div>
  
  <div class="footer shadow round-corner">
    
    <div class="grid-container">
      <div class="footer-recent-posts">
        <h6>Recent Posts</h6>
        <ol>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2024/02/13/">Qiita Hackathon [予選]</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2024/01/27/">自分のWebサイトを作りました！</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2024/01/01/">「Command &#39;cmd&#39; not found, but there are 18 similar ones.」と表示されてPythonが実行できない</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2023/12/24/">ラジコン用スピードメータの高速化</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2023/11/04/">ラジコン操縦アプリ「Happy RC Driver」のIOS対応化に向けて</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2023/09/08/">Bluetooth モジュールでRCサーボ・ESCを制御したい [第14回-走行用バッテリーからマイコンに給電]</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2023/08/11/">Bluetooth モジュールでRCサーボ・ESCを制御したい [第13回-ラジコンアプリに車速を表示]</a></li>
          
        </ol>
        <a href="/Happy_RC.github.io/archive">...ALL POSTS</a>
        <hr class="mobile white-hr" />
      </div>
      <div>
        <h6>Sections</h6>
<div class="section-container">
  
  
  <a class="section" href="https://tomokiikegami.github.io/Happy_RC.github.io/post/" aria-label="site sections"
    >Posts</a
  >
  
  
  
  
  
  
</div>

        









<h6>
  Tags
</h6>

<div class="taxa-container">
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/arduino/">Arduino</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E7%84%A1%E7%B7%9A%E9%80%9A%E4%BF%A1/">無線通信</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E8%87%AA%E4%BD%9C%E3%82%A2%E3%83%97%E3%83%AA/">自作アプリ</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/mit-app-inventor/">MIT App Inventor</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E3%82%B5%E3%83%BC%E3%83%9C/">サーボ</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/esc/">ESC</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/freecad/">FreeCAD</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/3d%E3%83%A2%E3%83%87%E3%83%AA%E3%83%B3%E3%82%B0/">3Dモデリング</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E6%A9%9F%E6%A2%B0%E8%A8%AD%E8%A8%88/">機械設計</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/3d%E3%83%97%E3%83%AA%E3%83%B3%E3%82%BF/">3Dプリンタ</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E3%82%AE%E3%82%A2/">ギア</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E3%82%B9%E3%83%9E%E3%83%9B/">スマホ</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/python/">Python</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/ultimaker-cura/">Ultimaker Cura</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E6%96%87%E5%AD%97%E8%A3%85%E9%A3%BE/">文字装飾</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/vs-code/">VS Code</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/word/">Word</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/arduinodroid/">ArduinoDroid</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/django/">Django</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/html%E3%82%BF%E3%82%B0/">htmlタグ</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/hugo/">hugo</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/ios/">IOS</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/libreoffice-draw/">LibreOffice Draw</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/thunkable/">Thunkable</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E3%83%8F%E3%83%83%E3%82%AB%E3%82%BD%E3%83%B3/">ハッカソン</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E3%83%90%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97/">バックアップ</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E3%83%9C%E3%83%87%E3%82%A3%E5%A1%97%E8%A3%85/">ボディ塗装</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E5%9B%B3%E3%81%AE%E4%BD%9C%E6%88%90/">図の作成</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E8%A8%88%E6%B8%AC%E5%88%B6%E5%BE%A1/">計測制御</a>
  
</div>


<h6>
  Categories
</h6>

<div class="taxa-container">
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/categories/%E3%83%A9%E3%82%B8%E3%82%B3%E3%83%B3/">ラジコン</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/categories/%E5%82%99%E5%BF%98%E9%8C%B2/">備忘録</a>
  
</div>


        <hr class="mobile white-hr" />
      </div>
    </div>
    
    <div class="footer-info-text">
      <p>
        
        <span>2024</span>
        <span>Tomoki Ikegami.</span>
        <span>I hope to enjoy your RC Life.</span>
      </p>
      <p>
        <a href="https://github.com/urjaacharya/redgood">redgood</a>
        by
        <a
          href="https://www.urjaacharya.com/"
          aria-label="link to urja acharya site"
        >urja acharya</a>
      </p>
    </div>
    <div style="text-align: right; margin-bottom: 0.25em; font-size: 1.2em">
      <a class="primary-icon to-top" href="#" aria-label="navigate to top">
        <i class="bi bi-arrow-up-circle-fill"></i>
      </a>
    </div>
  </div>
</footer>
</body>
</html>
