<!DOCTYPE html>
<html lang="ja"><head>
  <title>
     Bluetooth モジュールでRCサーボ・ESCを制御したい [第1回-RCサーボの制御] -  Happy RC Blog !
  </title>
  <meta name="theme-color" content="#a3001b" />
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta name="description" content="ラジコンが楽しくなるような工作やレポートを掲載したいと思います！ラジコン以外にもやってみて苦労したことや、面白かったことについても記録していく予定です！" />
  <meta name="author" content="Tomoki Ikegami" />

  <link rel="stylesheet" href="/Happy_RC.github.io/css/main.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500&family=Ubuntu+Mono&display=swap" rel="stylesheet">
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css"
  />
</head>
<body>
    
    <header class="regular-page-header shadow round-corner">
  <div
    style="
      display: flex;
      justify-content: space-between;
      width: 98%;
      margin-bottom: 0.5em;
    "
  >
    <a class="primary-icon" href="/Happy_RC.github.io/" aria-label="home page">
      <i class="bi bi-house-fill"></i>
    </a>
    
  </div>
  <div class="page-title-and-info" style="text-align: center">
    <h1 class="page-title" >
      Bluetooth モジュールでRCサーボ・ESCを制御したい [第1回-RCサーボの制御]
    </h1>
    
    <p class="document-date">
      2022-02-27 &middot; Tomoki Ikegami
    </p>
    
    <p class="document-description">"まずは無線でRCサーボを動かしてみる"</p>
     
  </div>
</header>

    
    <main class="card shadow round-corner">
<h1 id="-目次-----omit-in-toc---">～ 目次 ～ <!-- omit in toc --></h1>
<ul>
<li><a href="#1-%E6%9C%80%E7%B5%82%E7%9A%84%E3%81%AB%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8">1. 最終的にやりたいこと</a></li>
<li><a href="#2-%E5%AE%9F%E9%A8%93%E6%BA%96%E5%82%99">2. 実験準備</a>
<ul>
<li><a href="#21-%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%AE%E6%A6%82%E8%A6%81">2.1. システムの概要</a></li>
<li><a href="#22-%E5%9B%9E%E8%B7%AF%E5%9B%B3">2.2. 回路図</a></li>
<li><a href="#23-%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89">2.3. ソースコード</a></li>
</ul>
</li>
<li><a href="#3-%E5%8B%95%E4%BD%9C%E5%AE%9F%E9%A8%93%E7%B5%90%E6%9E%9C">3. 動作実験結果</a></li>
<li><a href="#4-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">4. 参考文献</a></li>
</ul>
<hr>
<h1 id="1-最終的にやりたいこと">1. 最終的にやりたいこと</h1>
<p>　最終的には、ラジコンのコントローラを作ることを目指しています。そのためには無線通信でRC装置を動かせるようになる必要があります。</p>
<p>　今回はその基礎として、PCをコントローラ、マイコン+Bluetoothモジュール をRC受信機と考えて実験を行いたいと思います。</p>
<h1 id="2-実験準備">2. 実験準備</h1>
<h2 id="21-システムの概要">2.1. システムの概要</h2>
<p>　下の図は使用する装置、ぞれぞれの装置の役割を整理したものです。</p>
  <div align="center">
  <figure><img src="rc_wireless_control_system_using_bt-module.svg"
         alt="システムの概要"/>
</figure>

  </div>
  <div style="text-align: center;">
  図：システムの概要
  </div>
<p>　PCから無線通信（Bluetooth）でArduinoへ信号を送り、ArduinoでサーボモータやESCの制御を行いたいと思います。</p>
<p>　BluetoothモジュールはHC-05<sup>※</sup>と呼ばれるものを使用しました。Amazonに1000円くらいで売っています。</p>
<p>　※ HC-05は技適マークがついていないので、屋内で実験目的として使用する程度にしたほうがよいです。</p>
<p>　ArduinoとHC-05を使用してLEDを点灯させる回路を作っている記事<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup><sup>,</sup><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>がいくつかあったので、そちらを参考にして回路を作成しました。</p>
<h2 id="22-回路図">2.2. 回路図</h2>
<p>　まずはRCサーボのみを無線通信で制御する回路をつくりました（下図参照）。マイコンへの5V電源（モバイルバッテリー）は省略しています。</p>
<p>　この回路では、サーボ用の電源を3.3[V]にしていますが、実際のRCでは6[V]で動かしていることが多いです。（ハイボルテージといって7.4[V]で動かす場合もあります）</p>
  <div align="center">
  <figure><img src="servo_motor_control_using_hc-05_v2.svg"
         alt="サーボモータ制御用の回路"/>
</figure>

  </div>
  <div style="text-align: center;">
  図：サーボモータ制御用の回路
  </div>
<p>　Bluetoothモジュールの動作用とサーボ駆動用の電源を別にしたかった<sup>※</sup>ので、このような（不思議な）回路になっています。しかしこれではトルクが足りません（笑）。とりあえず今回はこれでいきたいと思います。</p>
<p>※ Bluetoothモジュールとサーボモータで5V電源を共有すると、サーボモータが動いたときに通信が途切れてしまいました。</p>
<h2 id="23-ソースコード">2.3. ソースコード</h2>
<p>　こちらがArduinoマイコンに書き込んだソースコードです。</p>
<p>　サーボモータの制御には、VarSpeedServo.h<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>というライブラリを使いました。このライブラリは、サーボモータの回転速度も変更できるのがすごく便利です。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#960050;background-color:#1e0010">#</span>include <span style="color:#f92672">&lt;</span>SoftwareSerial<span style="color:#f92672">.</span><span style="color:#a6e22e">h</span><span style="color:#f92672">&gt;</span>  <span style="color:#75715e">//Bluetoothの無線通信に使用
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span>include <span style="color:#f92672">&lt;</span>VarSpeedServo<span style="color:#f92672">.</span><span style="color:#a6e22e">h</span><span style="color:#f92672">&gt;</span>  <span style="color:#75715e">//サーボモータの制御に使用
</span><span style="color:#75715e"></span>VarSpeedServo myservo<span style="color:#f92672">;</span>    <span style="color:#75715e">// create servo object to control a servo
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> mov_speed <span style="color:#f92672">=</span> 100<span style="color:#f92672">;</span> <span style="color:#75715e">//速度
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> center_pos <span style="color:#f92672">=</span> 90<span style="color:#f92672">;</span> <span style="color:#75715e">//ステア中心位置 [サーボモータの中心位置 (90°)]
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> left_pos <span style="color:#f92672">=</span> 90 <span style="color:#f92672">-</span> 45<span style="color:#f92672">;</span> <span style="color:#75715e">//左位置 [中心位置より反時計回りに45°回転した位置]
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> right_pos <span style="color:#f92672">=</span> 90 <span style="color:#f92672">+</span> 45<span style="color:#f92672">;</span> <span style="color:#75715e">//右位置 [中心位置より時計回りに45°回転した位置]
</span><span style="color:#75715e"></span>
<span style="color:#75715e">//速度v(mov_speed)は 1~255 の範囲で与える。（0にすると最大速度で移動）
</span><span style="color:#75715e">//サーボモータの回転角度θ(pos)の範囲は、 0°≦θ(pos)≦180°
</span><span style="color:#75715e">//myservo.write 関数には回転角を絶対的な位置で与える。例) 90°から 45°反時計回りに動いてほしいときは、-45°ではなく、45°を関数に入力する。
</span><span style="color:#75715e"></span>

SoftwareSerial <span style="color:#a6e22e">Bluetooth</span><span style="color:#f92672">(</span>10<span style="color:#f92672">,</span> 11<span style="color:#f92672">);</span> <span style="color:#75715e">// Arduinoから見て10ピンがRX（受信）, 11ピンがTX（送信)になる。bluetoothモジュールのTXにはArduinoのRX(10)が、bluetoothモジュールのRXにはArduinoのTX(11)が接続されていれば良い。
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  Bluetooth<span style="color:#f92672">.</span><span style="color:#a6e22e">begin</span><span style="color:#f92672">(</span>9600<span style="color:#f92672">);</span> <span style="color:#75715e">//シリアルポートを開いて、伝送速度を9600[bps] に設定
</span><span style="color:#75715e"></span>  myservo<span style="color:#f92672">.</span><span style="color:#a6e22e">attach</span><span style="color:#f92672">(</span>9<span style="color:#f92672">);</span> <span style="color:#75715e">//サーボモータのPWM端子とArduinoの9番ピンを接続
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>Bluetooth<span style="color:#f92672">.</span><span style="color:#a6e22e">available</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> input <span style="color:#f92672">=</span> Bluetooth<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>input <span style="color:#f92672">==</span> 4<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      myservo<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>left_pos<span style="color:#f92672">,</span> mov_speed<span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">);</span> <span style="color:#75715e">// ステアを左に切る
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>input <span style="color:#f92672">==</span> 5<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      myservo<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>center_pos<span style="color:#f92672">,</span> mov_speed<span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">);</span> <span style="color:#75715e">// ステアを中心に
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>input <span style="color:#f92672">==</span> 6<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      myservo<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>right_pos<span style="color:#f92672">,</span> mov_speed<span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>  <span style="color:#75715e">//ステアを右に切る
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
      <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>　PCから4が送られてきたらステアを左に、5が送られてきたらステアを中心に、6が送られてきたらステアを右に切るという単純なプログラムです。</p>
<h1 id="3-動作実験結果">3. 動作実験結果</h1>
<p>　先ほどの回路を組み立てて実験した様子がこちらの動画になります。</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/XoGBV71PzU4" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>　電圧が足りず前輪が接地した状態ではハンドルが切れていませんが、動かすことは出来ました！</p>
<p>　サーボ用には別の方法で電源供給する必要がありそうです。BEC<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>とかを使って電源供給すると良いかも&hellip;</p>
<h1 id="4-参考文献">4. 参考文献</h1>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Love on Technology「WindowsとArduinoとBluetoothモジュール(HC-05/HC-06)の接続方法」、(<a href="https://wireless-network.net/arduino-win-bt/">https://wireless-network.net/arduino-win-bt/</a>)&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>マーティーの工房日誌「Bluetooth Module HC-05でAndroidからRGB LED Controll」、(<a href="https://martyworkshopdiary.blogspot.com/2018/05/bluetooth-module-hc-05androidrgb-led.html">https://martyworkshopdiary.blogspot.com/2018/05/bluetooth-module-hc-05androidrgb-led.html</a>)&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>GitHub「NETLab Toolkit Group&gt;VarSpeedServo」、(<a href="https://github.com/netlabtoolkit/VarSpeedServo">https://github.com/netlabtoolkit/VarSpeedServo</a>)&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>KK HOBBY「HOME&gt;レギュレータ」、(<a href="https://www.kkhobby.com/SHOP/AP077.html">https://www.kkhobby.com/SHOP/AP077.html</a>)&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>


    </main><footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: { equationNumbers: {autoNumber: "AMS"} },
      tex2jax: {
        inlineMath: [['$','$']]
      }
    });
  </script>
  
  
  
  
  <div class="prev-next">
    <a
      class="active icon"
      href="/Happy_RC.github.io/2022/02/24/"
      aria-label="Previous Article"
      ><i class="bi bi-arrow-left-circle-fill"></i
    ></a>
    <a
      class="active icon"
      href="/Happy_RC.github.io/2022/03/05/"
      aria-label="Next Article"
      ><i class="bi bi-arrow-right-circle-fill"></i
    ></a>
  </div>
  </div>
  
  <div class="footer shadow round-corner">
    
    <div class="grid-container">
      <div class="footer-recent-posts">
        <h6>Recent Posts</h6>
        <ol>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2022/10/09/">Bluetooth モジュールでRCサーボ・ESCを制御したい [第8回-ターボ機能を追加]</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2022/09/29/">Bluetooth モジュールでRCサーボ・ESCを制御したい [第7回-回路をシンプル＆コンパクトに]</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2022/09/27/">Bluetooth モジュールでRCサーボ・ESCを制御したい [第6回-動きを滑らかに]</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2022/09/12/">GS02のタイヤを浮かせたい！</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2022/08/30/">Bluetooth モジュールでRCサーボ・ESCを制御したい [第5回-安全性の向上]</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2022/08/20/">Bluetooth モジュールでRCサーボ・ESCを制御したい [第4回-操作性の向上]</a></li>
          
          <li><a href="https://tomokiikegami.github.io/Happy_RC.github.io/2022/08/16/">LibreOffice Draw を使って教科書みたいなカッコイイ図を作る！</a></li>
          
        </ol>
        <a href="/Happy_RC.github.io/archive">...ALL POSTS</a>
        <hr class="mobile white-hr" />
      </div>
      <div>
        <h6>Sections</h6>
<div class="section-container">
  
  
  <a class="section" href="https://tomokiikegami.github.io/Happy_RC.github.io/post/" aria-label="site sections"
    >Posts</a
  >
  
  
  
  
  
  
</div>

        









<h6>
  Tags
</h6>

<div class="taxa-container">
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/arduino/">Arduino</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E3%82%B5%E3%83%BC%E3%83%9C/">サーボ</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E7%84%A1%E7%B7%9A%E9%80%9A%E4%BF%A1/">無線通信</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/esc/">ESC</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/freecad/">FreeCAD</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/3d%E3%83%A2%E3%83%87%E3%83%AA%E3%83%B3%E3%82%B0/">3Dモデリング</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/mit-app-inventor/">MIT App Inventor</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E8%87%AA%E4%BD%9C%E3%82%A2%E3%83%97%E3%83%AA/">自作アプリ</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E6%A9%9F%E6%A2%B0%E8%A8%AD%E8%A8%88/">機械設計</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/3d%E3%83%97%E3%83%AA%E3%83%B3%E3%82%BF/">3Dプリンタ</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E3%82%AE%E3%82%A2/">ギア</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/ultimaker-cura/">Ultimaker Cura</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/html%E3%82%BF%E3%82%B0/">htmlタグ</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/hugo/">hugo</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/libreoffice-draw/">LibreOffice Draw</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/word/">Word</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E3%83%9C%E3%83%87%E3%82%A3%E5%A1%97%E8%A3%85/">ボディ塗装</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E5%9B%B3%E3%81%AE%E4%BD%9C%E6%88%90/">図の作成</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/tags/%E6%96%87%E5%AD%97%E8%A3%85%E9%A3%BE/">文字装飾</a>
  
</div>


<h6>
  Categories
</h6>

<div class="taxa-container">
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/categories/%E3%83%A9%E3%82%B8%E3%82%B3%E3%83%B3/">ラジコン</a>
  
  
    <a class="taxa" href="https://tomokiikegami.github.io/Happy_RC.github.io/categories/%E5%82%99%E5%BF%98%E9%8C%B2/">備忘録</a>
  
</div>


        <hr class="mobile white-hr" />
      </div>
    </div>
    
    <div class="footer-info-text">
      <p>
        
        <span>2022</span>
        <span>Tomoki Ikegami.</span>
        <span>I hope to enjoy your RC Life.</span>
      </p>
      <p>
        <a href="https://github.com/urjaacharya/redgood">redgood</a>
        by
        <a
          href="https://www.urjaacharya.com/"
          aria-label="link to urja acharya site"
        >urja acharya</a>
      </p>
    </div>
    <div style="text-align: right; margin-bottom: 0.25em; font-size: 1.2em">
      <a class="primary-icon to-top" href="#" aria-label="navigate to top">
        <i class="bi bi-arrow-up-circle-fill"></i>
      </a>
    </div>
  </div>
</footer>
</body>
</html>
